<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Video Editor - HD Server Edition</title>
    <style>
        :root { --primary: #0d6efd; --dark: #212529; --light: #f8f9fa; }
        body { font-family: sans-serif; background: #e9ecef; margin: 0; padding: 15px; padding-bottom: 100px; }
        .header { background: var(--primary); color: white; padding: 15px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px; text-align: center; }
        .card { background: white; padding: 20px; border-radius: 15px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        h3 { margin-top: 0; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; color: var(--dark); font-size: 16px; }
        label { display: block; font-weight: bold; font-size: 13px; margin-top: 10px; color: #555; }
        input[type="file"] { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        .btn-add { background: #198754; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-top: 5px; font-size: 14px; }
        .clip-list { display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; }
        .clip-item { min-width: 100px; height: 100px; position: relative; border-radius: 8px; overflow: hidden; border: 2px solid #ddd; }
        .clip-item img { width: 100%; height: 100%; object-fit: cover; }
        .clip-dur { position: absolute; bottom: 0; background: rgba(0,0,0,0.7); color: white; width: 100%; text-align: center; font-size: 10px; padding: 2px; }
        .export-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); text-align: center; }
        .btn-export { background: linear-gradient(135deg, #0d6efd, #0a58ca); color: white; border: none; padding: 15px 30px; border-radius: 30px; font-weight: bold; font-size: 16px; width: 100%; max-width: 400px; cursor: pointer; box-shadow: 0 4px 15px rgba(13,110,253,0.4); }
        .btn-export:disabled { background: #ccc; cursor: not-allowed; }
        #serverIndicator { font-size: 12px; font-weight: bold; margin-top: 5px; }
        .status-offline { color: green; }
        .status-waking { color: orange; animation: blink 1.5s infinite; }
        #loader { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 9999; display: none; flex-direction: column; align-items: center; justify-content: center; color: white; }
        .spinner { width: 60px; height: 60px; border: 6px solid #f3f3f3; border-top: 6px solid #0d6efd; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes blink { 50% { opacity: 0.5; } }
    </style>
</head>
<body>

    <div class="header">
        <h2>News Video Editor (HD) – अब बिल्कुल ठीक</h2>
        <div id="serverIndicator" class="status-waking">Connecting...</div>
    </div>

    <div class="card">
        <h3>1. Audio (Voiceover)</h3>
        <label>मेन वॉइसओवर ऑडियो:</label>
        <input type="file" id="mainAudio" accept="audio/*"><br><br>
        <label>बैकग्राउंड म्यूजिक (ऑप्शनल):</label>
        <input type="file" id="bgMusic" accept="audio/*">
    </div>

    <div class="card">
        <h3>2. इमेजेस (एक से ज्यादा चुन सकते हैं)</h3>
        <input type="file" id="imageInput" accept="image/*" multiple onchange="handleImages(this)">
        <div class="clip-list" id="clipContainer"><div style="padding:20px;color:#999;">कोई फोटो नहीं</div></div>
        <p style="font-size:12px;color:#666;">हर फोटो 5 सेकंड तक दिखेगी</p>
    </div>

    <div class="card">
        <h3>3. लोगो (PNG ट्रांसपेरेंट बेस्ट)</h3>
        <input type="file" id="logoInput" accept="image/*">
    </div>

    <div class="export-bar">
        <button class="btn-export" onclick="exportVideo()">Export Full HD Video</button>
    </div>

    <div id="loader">
        <div class="spinner"></div>
        <div style="font-size:22px;font-weight:bold;" id="statusText">तैयार हो रहा है...</div>
        <div style="margin-top:10px;" id="statusDetail"></div>
    </div>

<script>
    const SERVER_URL = "https://news-video-server.onrender.com/render"; // अपना URL डालें

    let clips = [];

    // Server status
    fetch("https://news-video-server.onrender.com").then(r=>r.ok?document.getElementById('serverIndicator').innerHTML='Server Online':null).catch(()=>null);

    function handleImages(e){
        const c = document.getElementById('clipContainer');
        c.innerHTML='';
        clips=[];
        Array.from(e.files).forEach((f,i)=>{
            const d=document.createElement('div'); d.className='clip-item';
            d.innerHTML=`<img src="${URL.createObjectURL(f)}"><div class="clip-dur">Img ${i+1}</div>`;
            c.appendChild(d);
            clips.push({file:f, duration:5});
        });
    }

    const toBase64 = file => new Promise((res,rej)=>{
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = ()=>res(reader.result);
        reader.onerror = error => rej(error);
    });

    async function exportVideo(){
        const loader = document.getElementById('loader');
        const mainAudio = document.getElementById('mainAudio').files[0];
        const bgm = document.getElementById('bgMusic').files[0];
        const logo = document.getElementById('logoInput').files[0];

        if(!mainAudio) return alert("वॉइसओवर ऑडियो जरूरी है!");
        if(clips.length===0) return alert("कम से कम एक फोटो चुनें!");

        loader.style.display='flex';
        document.getElementById('statusText').innerText = "फाइलें तैयार हो रही हैं...";

        try{
            const audioB64 = await toBase64(mainAudio);
            const bgmB64 = bgm ? await toBase64(bgm) : null;
            const logoB64 = logo ? await toBase64(logo) : null;

            const clipsData = [];
            for(let i=0;i<clips.length;i++){
                document.getElementById('statusDetail').innerText = `इमेज ${i+1}/${clips.length} पढ़ रहा है...`;
                clipsData.push({imageData: await toBase64(clips[i].file), duration:5});
            }

            document.getElementById('statusText').innerText = "वीडियो बन रहा है...";
            document.getElementById('statusDetail').innerText = "कृपया इंतजार करें (पहली बार 1-2 मिनट लग सकते हैं)";

            const res = await fetch(SERVER_URL, {
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body:JSON.stringify({
                    audioData: audioB64,
                    bgmData: bgmB64 || null,
                    logoData: logoB64 || null,
                    clips: clipsData
                })
            });

            if(!res.ok) throw new Error(await res.text());

            const blob = await res.blob();
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href=url; a.download=`News_${Date.now()}.mp4`; a.click();

            loader.style.display='none';
            alert("वीडियो बनकर तैयार हो गया!");

        }catch(err){
            loader.style.display='none';
            alert("Error: "+(err.message || "कुछ गलत हुआ"));
            console.error(err);
        }
    }
</script>
</body>
</html>
